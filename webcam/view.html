<head>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.96.1/css/materialize.min.css">
	<!-- Compiled and minified JavaScript -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.96.1/js/materialize.min.js"></script>
	<script src="http://noctur.me:8255/socket.io/socket.io.js"></script>
	<title>La Webcam du Local E-EISTI</title>
</head>

<body>

	<nav>
		<div class="nav-wrapper blue accent-2">
			<a href="#" class="brand-logo center ">La Webcam du Local</a>
		</div>
	</nav>

	<br/>
	<br/>

	<!-- Page Layout here -->

	<div class="row container">

	<center>


		<!-- Teal page content

		This content will be:

		9-columns-wide on large screens,

		8-columns-wide on medium screens,

		12-columns-wide on small screens -->
		<div class="col s12 m12 l11"  onclick="refreshPicture(1); refreshPicture(2);">
			<ul id="wat" class="tabs" style="margin-bottom:5px;">
			        <li class="tab col s3 "><a class="active" href="#cam1">Camera 1</a></li>
			        <li class="tab col s3 "><a href="#cam2">Camera 2</a></li>
			</ul>


			<div id="cam1" style=""> <!-- Note that "m8 l9" was added -->
				<img class="z-depth-3 responsive-img" id="jej1" width="640" height="480" alt="Live Stream" id="webcam1" src="cam_1.jpg">
			</div>

			<div id="cam2" style="">
				<img class="z-depth-3 responsive-img" id="jej2" width="640" height="480" alt="Live Stream" id="webcam2" src="cam_2.jpg">
			</div>
		</div>
		 

		<div class="col s12 m12 l1" id="buttons" style="margin-top:20px">

			<a data-delay="10" data-position="top" style="margin-bottom: 8px; margin-left: 8px" id="main" class="btn-floating btn-large btn tooltipped waves-effect waves-light blue accent-2" onclick="savePicture()" data-tooltip="Take Screenshot"><i class="mdi-image-camera-alt"></i></a>
  
			<a data-delay="10" data-position="top" style="margin-bottom: 8px; margin-left: 8px" id="main" class="btn-floating btn-large waves-effect waves-light blue accent-2 btn tooltipped" onclick="streamSwitch(true)" data-tooltip="Switch Stream Type"><i class="mdi-av-videocam"></i></a>

			 <a data-delay="10" data-position="top" style="margin-bottom: 8px; margin-left: 8px" class="btn-floating btn-large red btn tooltipped" data-tooltip="Viewers"><span id="viewers" style=" font-size:30px">1</span></a>
   
			  <br>
			  <br>
			  <div id="stream_indic" style="color: #9e9e9e;margin-left: 10px">Stream: JS</div>
  
		</div>

	</center>

	</div>

	 

	<div class="row container">

	<div class="col s12 m12 l12">

		<div class="card blue lighten-2 z-depth 3">

			<div class="card-content white-text" id="screenshots">

				<p>Screenshots (Right click to save) :</p>

				<br/>

			</div>

		</div>

	</div>

	</div>

	 

	<script>

	focused=true;
	stream="javascript";
	cam1Timer = setInterval("refreshPicture(1)", 150);
	cam2Timer = setInterval("refreshPicture(2)", 150);

	//One sec
	var timeout = 5000;
	//Starting socket.io
	var t = io.connect("http://noctur.me:8255", {
		'connect timeout': timeout,
		'reconnect': true,
		'reconnection delay': 2000,
		'max reconnection attempts': 10000,
		'force new connection':true
	});
	
	t.on('users', function(msg) {
    document.getElementById("viewers").innerHTML=msg;
	});
	
	
	function onBlur() {
		focused=false;
	};

	function onFocus(){
		focused=true;
	}; 


	if (/*@cc_on!@*/false) { // check for Internet Explorer
		document.onfocusin = onFocus;
		document.onfocusout = onBlur;
	} else {
		window.onfocus = onFocus;
		window.onblur = onBlur;
	} 

	function streamSwitch(showToast)
	{
		clearInterval(cam1Timer);
		clearInterval(cam2Timer);

		if (stream=="mjpeg")
		{
			stream="javascript";
			document.getElementById("stream_indic").innerHTML="Stream: JS";
			cam1Timer = setInterval("refreshPicture(1)", 150);
			cam2Timer = setInterval("refreshPicture(2)", 150);
			if(showToast)
				Materialize.toast('Stream switched to Javascript.', 2000);

		}
		else
		{
			stream="mjpeg";
			document.getElementById("stream_indic").innerHTML="Stream: MJPEG";
			cam1Timer = setInterval("refreshPicture(1)", 30000);
			cam2Timer = setInterval("refreshPicture(2)", 30000);
			if(showToast)
				Materialize.toast('Stream switched to MJPEG.', 2000);
		}

		refreshPicture(1);
		refreshPicture(2);
		
	}

	function refreshPicture(camNumb)
	{

		//console.log(camNumb);
		var wb = document.getElementById("cam"+camNumb);

		if (wb.style.display!="none")
		{
			if (stream=="javascript")
				document.getElementById("jej"+camNumb).src="cam_"+camNumb+".jpg?"+ new Date().getTime();
			else
				document.getElementById("jej"+camNumb).src="cam_"+camNumb+".cgi?"+ new Date().getTime();
		}

	}

	function savePicture()
	{

		var wb1 = document.getElementById("cam1");

		var wb2 = document.getElementById("cam2");

		var newElement = document.createElement('img');

		newElement.style.width="10%"; 
		newElement.style.marginRight="5px";

		if (wb1.style.display=="none")
			newElement.src="cam_2.jpg?"+ new Date().getTime();
		else
			newElement.src="cam_1.jpg?"+ new Date().getTime();
			newElement.class="z-depth-1";
			document.getElementById("screenshots").appendChild(newElement);
			Materialize.toast('Screenshot Saved!', 1000);

	}

	</script>

</body> 




